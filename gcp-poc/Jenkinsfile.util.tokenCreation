#!/usr/bin/env groovy

def call(){
    withCredentials([file(credentialsId: 'gcp-cred', variable: 'credentials_file')]){
        sh(script: 'gcloud components update -q')
        sh(script: '''
            export GOOGLE_APPLICATION_CREDENTIALS=${credentials_file}
            gcloud auth application-default print-access-token > token.txt
            ''', returnStdout: true)
        sh (script: 'gcloud auth activate-service-account --key-file ${credentials_file}')
    }
}
return this